specVersion: 0.0.2
description: Synthetix API
repository: https://github.com/Synthetixio/synthetix-subgraph
schema:
  file: ./synthetix.graphql
dataSources:
  - kind: ethereum/contract
    name: Synthetix
    network: optimism
    source:
      address: '0x8700dAec35aF8Ff88c16BdF0418774CB3D7599B4' # new ProxySynthetix (ERC20)
      abi: Synthetix
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - Transfer
      abis:
        - name: Synthetix
          file: ../abis/Synthetix.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
        - name: SynthetixState
          file: ../abis/SynthetixState.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransferSNX

  # Handle Transfer on upcoming ProxysUSD Integration proxy
  - kind: ethereum/contract
    name: SynthsUSD_viaNewProxy
    network: optimism
    source:
      address: '0x57Ab1ec28D129707052df4dF418D58a2D46d5f51' # ProxyERC20sUSD (new ERC20 Proxy)
      abi: Synth
      startBlock: 8621971 # creation of this proxy
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - Transfer
        - Issued
        - Burned
      abis:
        - name: Synth
          file: ../abis/Synth.json
        - name: Synthetix
          file: ../abis/Synthetix.json
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
        - name: SynthetixState
          file: ../abis/SynthetixState.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransferSynth
        - event: Issued(indexed address,uint256)
          handler: handleIssuedSynths
        - event: Burned(indexed address,uint256)
          handler: handleBurnedSynths


  # Handle Transfer, Issued, Burned on current ProxysETH
  - kind: ethereum/contract
    name: SynthsETH
    network: optimism
    source:
      address: '0x5e74C9036fb86BD7eCdcb084a0673EFc32eA31cb' # ProxysETH (new ERC20 Proxy)
      abi: Synth
      startBlock: 8533639
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - Transfer
        - Issued
        - Burned
      abis:
        - name: Synth
          file: ../abis/Synth.json
        - name: Synthetix
          file: ../abis/Synthetix.json
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
        - name: SynthetixState
          file: ../abis/SynthetixState.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransferSynth
        - event: Issued(indexed address,uint256)
          handler: handleIssuedSynths
        - event: Burned(indexed address,uint256)
          handler: handleBurnedSynths

    # Handle Transfer, Issued, Burned on previous ProxysBTC (since decommissioned and upgraded to ProxyERC20 in July 2019)
  - kind: ethereum/contract
    name: SynthsBTC_viaOldProxy
    network: optimism
    source:
      address: '0x9073Ee83b6CE96C444547DdCAf777b9352163581' # old ProxysBTC
      abi: Synth
      startBlock: 7264883 # creation of this proxy
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - Transfer
        - Issued
        - Burned
      abis:
        - name: Synth
          file: ../abis/Synth.json
        - name: Synthetix
          file: ../abis/Synthetix.json
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
        - name: SynthetixState
          file: ../abis/SynthetixState.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransferSynth
        - event: Issued(indexed address,uint256)
          handler: handleIssuedSynths
        - event: Burned(indexed address,uint256)
          handler: handleBurnedSynths

  - kind: ethereum/contract
    name: SynthsBTC
    network: optimism
    source:
      address: '0xfE18be6b3Bd88A2D2A7f928d00292E7a9963CfC6' # ProxysBTC
      abi: Synth
      startBlock: 8623122 # creation of this proxy
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - Transfer
        - Issued
        - Burned
      abis:
        - name: Synth
          file: ../abis/Synth.json
        - name: Synthetix
          file: ../abis/Synthetix.json
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
        - name: SynthetixState
          file: ../abis/SynthetixState.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransferSynth
        - event: Issued(indexed address,uint256)
          handler: handleIssuedSynths
        - event: Burned(indexed address,uint256)
          handler: handleBurnedSynths

  # Handle Transfer on previous ProxyiETH (since decommissioned and upgraded to ProxyERC20 in July 2019)
  # This is to be able to track potential iETH holders
  - kind: ethereum/contract
    name: SynthiETH_viaOldProxy
    network: optimism
    source:
      address: '0x9B7E40031f7d4f6AB6e5D36bBF2Fea3bCCcc75a5' # (old iETH Proxy)
      abi: Synth
      startBlock: 7680400
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - Transfer
        - SynthHolder
      abis:
        - name: Synth
          file: ../abis/Synth.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransferSynth

  - kind: ethereum/contract
    name: SynthiETH
    network: optimism
    source:
      address: '0xA9859874e1743A32409f75bB11549892138BBA1E' # (new ERC20 iETH Proxy)
      abi: Synth
      startBlock: 8623214
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - Transfer
        - SynthHolder
      abis:
        - name: Synth
          file: ../abis/Synth.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransferSynth

  # Handle RewardEscrow Transfers (determine who has collected fees)
  - kind: ethereum/contract
    name: RewardEscrow
    network: optimism
    source:
      address: '0xb671F2210B1F6621A2607EA63E6B2DC3e2464d1F' # RewardEscrow
      abi: RewardEscrow
      startBlock: 7680399
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - RewardEscrowHolder
        - SNXHolder
      abis:
        - name: RewardEscrow
          file: ../abis/RewardEscrow.json
        - name: Synthetix
          file: ../abis/Synthetix.json
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
        - name: SynthetixState
          file: ../abis/SynthetixState.json
      eventHandlers:
        - event: VestingEntryCreated(indexed address,uint256,uint256)
          handler: handleRewardVestEvent
        - event: Vested(indexed address,uint256,uint256)
          handler: handleRewardVestEvent

  # Handle FeePool FeesClaimed
  - kind: ethereum/contract
    name: FeePool
    network: optimism
    source:
      address: '0xb440DD674e1243644791a4AdfE3A2AbB0A92d309' # ProxyFeePool
      abi: FeePool
      startBlock: 7680399
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - FeesClaimed
        - SNXHolder
      abis:
        - name: FeePool
          file: ../abis/FeePool.json
        - name: FeePoolv217
          file: ../abis/FeePool_v2.17.json
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
      eventHandlers:
        - event: FeesClaimed(address,uint256,uint256)
          handler: handleFeesClaimed

  # Handle FeePool FeesClaimed
  - kind: ethereum/contract
    name: FeePool_2
    network: optimism
    source:
      address: '0x28d8458C76C7029257BAA10F86E9dA7481C513fb' # ProxyFeePool
      abi: FeePool
      startBlock: 11513104
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/mapping.ts
      entities:
        - FeesClaimed
        - SNXHolder
      abis:
        - name: FeePool
          file: ../abis/FeePool.json
        - name: FeePoolv217
          file: ../abis/FeePool_v2.17.json
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json
      eventHandlers:
        - event: FeesClaimed(address,uint256,uint256)
          handler: handleFeesClaimed
    - kind: ethereum/contract
    name: Exchanger
    network: optimism
    source:
      address: '0x439502C922ADA61FE49329248B7A8ecb31C0b329'
      abi: Exchanger
      startBlock: 10557958
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - ExchangeEntrySettled
        - ExchangeEntryAppended
        - TemporaryExchangePartnerTracker
      abis:
        - name: Exchanger
          file: ../abis/Exchanger.json
      eventHandlers:
        - event: ExchangeEntrySettled(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntrySettled
        - event: ExchangeEntryAppended(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntryAppended
  - kind: ethereum/contract
    name: Exchanger_v2
    network: optimism
    source:
      address: '0x1d53a13D78766C0Db6eF73eC0ae1138eA2b6f5D4'
      abi: Exchanger
      startBlock: 10772592
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - ExchangeEntrySettled
        - ExchangeEntryAppended
        - TemporaryExchangePartnerTracker
      abis:
        - name: Exchanger
          file: ../abis/Exchanger.json
      eventHandlers:
        - event: ExchangeEntrySettled(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntrySettled
        - event: ExchangeEntryAppended(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntryAppended
  - kind: ethereum/contract
    name: Exchanger_v3
    network: optimism
    source:
      address: '0xc4942df0d3c561c71417BBA09d2DEA7a3CC676Fb'
      abi: Exchanger
      startBlock: 11012438
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - ExchangeEntrySettled
        - ExchangeEntryAppended
        - TemporaryExchangePartnerTracker
      abis:
        - name: Exchanger
          file: ../abis/Exchanger.json
      eventHandlers:
        - event: ExchangeEntrySettled(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntrySettled
        - event: ExchangeEntryAppended(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntryAppended
  - kind: ethereum/contract
    name: Exchanger_v4
    network: optimism
    source:
      address: '0x300F0f100389282b51F1Bc486D8c2ad22B6C4E42'
      abi: Exchanger
      startBlock: 11239644
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - ExchangeEntrySettled
        - ExchangeEntryAppended
        - TemporaryExchangePartnerTracker
      abis:
        - name: Exchanger
          file: ../abis/Exchanger.json
      eventHandlers:
        - event: ExchangeEntrySettled(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntrySettled
        - event: ExchangeEntryAppended(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntryAppended
  - kind: ethereum/contract
    name: Exchanger_v5
    network: optimism
    source:
      address: '0xd3970a9D35d2Be3aaf62D2b5B2be3Ee303aC4228'
      abi: Exchanger
      startBlock: 11247235
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - ExchangeEntrySettled
        - ExchangeEntryAppended
        - TemporaryExchangePartnerTracker
      abis:
        - name: Exchanger
          file: ../abis/Exchanger.json
      eventHandlers:
        - event: ExchangeEntrySettled(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntrySettled
        - event: ExchangeEntryAppended(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntryAppended
  - kind: ethereum/contract
    name: Exchanger_v6
    network: optimism
    source:
      address: '0x93b434b2e21d0F4E3ed1e9efa3Aa254A6D863B2A'
      abi: Exchanger
      startBlock: 11363405
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - ExchangeEntrySettled
        - ExchangeEntryAppended
        - TemporaryExchangePartnerTracker
      abis:
        - name: Exchanger
          file: ../abis/Exchanger.json
      eventHandlers:
        - event: ExchangeEntrySettled(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntrySettled
        - event: ExchangeEntryAppended(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntryAppended
  - kind: ethereum/contract
    name: Exchanger_v7
    network: optimism
    source:
      address: '0x0bfDc04B38251394542586969E2356d0D731f7DE'
      abi: Exchanger
      startBlock: 11513107
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - ExchangeEntrySettled
        - ExchangeEntryAppended
        - TemporaryExchangePartnerTracker
      abis:
        - name: Exchanger
          file: ../abis/Exchanger.json
      eventHandlers:
        - event: ExchangeEntrySettled(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntrySettled
        - event: ExchangeEntryAppended(indexed address,bytes32,uint256,bytes32,uint256,uint256,uint256,uint256)
          handler: handleExchangeEntryAppended
  - kind: ethereum/contract
    name: Synthetix
    network: optimism
    source:
      address: '0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F'
      abi: Synthetix
      startBlock: 10782000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanger-mapping.ts
      entities:
        - DailyExchangePartner
        - ExchangePartner
        - TemporaryExchangePartnerTracker
      abis:
        - name: Synthetix
          file: ../abis/Synthetix.json
      eventHandlers:
        - event: ExchangeTracking(indexed bytes32,bytes32,uint256,uint256)
          handler: handleExchangeTracking
    - kind: ethereum/contract
    name: Synthetix
    network: optimism
    source:
      address: '0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F' # new ProxySynthetix (ERC20)
      abi: Synthetix
      startBlock: 10000000 # prior to migration to new proxy on May 10, 2020
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/exchanges-mapping.ts
      entities:
        - SynthExchange
        - ExchangeReclaim
        - ExchangeRebate
      abis:
        - name: Synthetix4
          file: ../abis/Synthetix_bytes4.json # Need to have this here to distinguish it in the code
        - name: Synthetix32
          file: ../abis/Synthetix_bytes32.json # Can assume bytes32 due to event signature below
        - name: Synthetix
          file: ../abis/Synthetix.json # Can assume bytes32 due to event signature below
        - name: AddressResolver
          file: ../abis/AddressResolver.json
        - name: ExchangeRates
          file: ../abis/ExchangeRates.json
      eventHandlers:
        - event: SynthExchange(indexed address,bytes32,uint256,bytes32,uint256,address)
          handler: handleSynthExchange32
        - event: ExchangeReclaim(indexed address,bytes32,uint256)
          handler: handleExchangeReclaim
        - event: ExchangeRebate(indexed address,bytes32,uint256)
          handler: handleExchangeRebate
    - kind: ethereum/contract
    name: AggregatorXRP_4
    network: optimism
    source:
      address: '0x4d839a486EC0B1C9b0D9e9D397993Ba5B150cB34'
      abi: Aggregator
      startBlock: 11922580
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/rates-mapping.ts
      entities:
        - AggregatorAnswer
      abis:
        - name: Aggregator
          file: ../abis/Aggregator.json
        - name: ExchangeRates
          file: ../abis/ExchangeRates.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
      eventHandlers:
        - event: AnswerUpdated(indexed int256,indexed uint256,uint256)
          handler: handleAggregatorAnswerUpdated
  - kind: ethereum/contract
    name: AggregatorBCH_4
    network: optimism
    source:
      address: '0xd054be48Ae13A89a82744373f647A755dF7CaE17'
      abi: Aggregator
      startBlock: 11922597
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/rates-mapping.ts
      entities:
        - AggregatorAnswer
      abis:
        - name: Aggregator
          file: ../abis/Aggregator.json
        - name: ExchangeRates
          file: ../abis/ExchangeRates.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
      eventHandlers:
        - event: AnswerUpdated(indexed int256,indexed uint256,uint256)
          handler: handleAggregatorAnswerUpdated
  - kind: ethereum/contract
    name: AggregatorEOS_4
    network: optimism
    source:
      address: '0xea7C55976844396f3bD4C89F66988b8b5Be5E96a'
      abi: Aggregator
      startBlock: 11922606
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      file: ../src/rates-mapping.ts
      entities:
        - AggregatorAnswer
      abis:
        - name: Aggregator
          file: ../abis/Aggregator.json
        - name: ExchangeRates
          file: ../abis/ExchangeRates.json
        - name: AddressResolver
          file: ../abis/AddressResolver.json
      eventHandlers:
        - event: AnswerUpdated(indexed int256,indexed uint256,uint256)
          handler: handleAggregatorAnswerUpdated

