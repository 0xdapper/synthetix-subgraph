!function(e,n){"function"==typeof define&&define.amd?define(["fetch"],(function(t){return e.snxSubgraph=n(t)})):"object"==typeof module&&module.exports?module.exports=n(require("node-fetch")):e.snxData=n(e.fetch)}("undefined"!=typeof self?self:this,(function(e){"use strict";const n="https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-depot",t="https://api.thegraph.com/subgraphs/name/synthetixio-team/synthetix-exchanges",r=({api:n,queryCreator:t,field:r})=>{const o=({skip:s})=>e(n,{method:"POST",body:t({skip:s}).replace(/\n+/g,"")}).then(e=>e.json()).then(e=>{if(e.errors)throw Error(JSON.stringify(e.errors));const{data:{[r]:n}}=e;return n.length<100?n:o({skip:s+100}).then(e=>n.concat(e))});return o({skip:0})},o=e=>{const n=e.toString();let t="";for(let e=2;e<n.length;e+=2){const r=n.substr(e,2);"00"!==r&&(t+=String.fromCharCode(parseInt(r,16)))}return t};return{pageResults:r,depot:{userActions:({network:e="mainnet",user:t})=>r({api:n,field:"userActions",queryCreator:({skip:n})=>`{\n              "query": "{\n                userActions(\n                  first:100,\n                  skip:${n},\n                  orderBy:timestamp,\n                  orderDirection:desc,\n                  where: {\n                    network: \\"${e}\\",\n                    user: \\"${t}\\"\n                  }\n                ){\n                  id,\n                  user\n                  amount,\n                  minimum,\n                  depositIndex,\n                  type,\n                  block,\n                  timestamp\n                }\n              }",\n              "variables": null\n            }`}).then(e=>e.map(({id:e,user:n,amount:t,type:r,minimum:o,depositIndex:s,block:a,timestamp:i})=>({hash:e.split("-")[0],user:n,amount:t/1e18,type:r,minimum:null!==o?Number(o):null,depositIndex:null!==s?Number(s):null,block:Number(a),timestamp:Number(1e3*i),date:new Date(1e3*i)}))).catch(e=>console.error(e))},exchanges:{total:({network:e="mainnet"}={})=>r({api:t,field:"totals",queryCreator:()=>`{\n              "query": "{\n                totals(\n                  first: 1,\n                  where: {\n                    id: \\"${e}\\"\n                  }\n                ){\n                  id,\n                  exchangers,\n                  exchangeUSDTally,\n                  totalFeesGeneratedInUSD\n                }\n              }",\n              "variables": null\n            }`}).then(([{id:e,exchangers:n,exchangeUSDTally:t,totalFeesGeneratedInUSD:r}])=>({id:e,exchangers:Number(n),exchangeUSDTally:t/1e18,totalFeesGeneratedInUSD:r/1e18})).catch(e=>console.error(e)),since:({network:e="mainnet",timestampInSecs:n=Math.floor(Date.now()/1e3)-86400}={})=>r({api:t,field:"synthExchanges",queryCreator:({skip:t})=>`{\n              "query":"{\n                synthExchanges(\n                  first:100,\n                  skip:${t},\n                  orderBy:timestamp,\n                  orderDirection:desc,\n                  where:{\n                    network: \\"${e}\\",\n                    timestamp_gt: ${n}\n                  }\n                ){\n                  id,\n                  from,\n                  gasPrice,\n                  from,\n                  fromAmount,\n                  fromAmountInUSD,\n                  fromCurrencyKey,\n                  toCurrencyKey,\n                  toAddress,\n                  toAmount,\n                  toAmountInUSD,\n                  feesInUSD,\n                  block,\n                  timestamp\n                }\n              }",\n              "variables":null\n            }`}).then(e=>e.map(({gasPrice:e,timestamp:n,id:t,from:r,fromAmount:s,block:a,fromAmountInUSD:i,fromCurrencyKey:m,toAddress:u,toAmount:c,toAmountInUSD:l,toCurrencyKey:d,feesInUSD:h})=>({gasPrice:e/1e9,block:Number(a),timestamp:Number(1e3*n),date:new Date(1e3*n),hash:t.split("-")[0],fromAddress:r,fromAmount:s/1e18,fromCurrencyKeyBytes:m,fromCurrencyKey:o(m),fromAmountInUSD:i/1e18,toAmount:c/1e18,toAmountInUSD:l/1e18,toCurrencyKeyBytes:d,toCurrencyKey:o(d),toAddress:u,feesInUSD:h/1e18}))).catch(e=>console.error(e))}}}));
